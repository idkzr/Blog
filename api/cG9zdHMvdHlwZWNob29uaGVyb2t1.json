{"title":"Heroku部署安装Typecho","date":"2020-11-26T14:11:00.000Z","date_formatted":{"ll":"2020年11月26日","L":"2020/11/26","MM-DD":"11-26"},"thumbnail":"https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/typechoonheroku/cover.jpg","color":"#111","link":"posts/typechoonheroku","comments":true,"tags":["Heroku,Typecho"],"categories":["瞎折腾"],"updated":"2020-11-26T14:11:00.000Z","content":"<p>突然发现Heroku的玩法属实不少，便想着能不能在Heroku上部署安装Typecho，写篇文章记录一下。</p>\n<a id=\"more\"></a>\n<h2 id=\"什么是-heroku？\">什么是 Heroku？<a title=\"#什么是-heroku？\" href=\"#什么是-heroku？\"></a></h2>\n<p>Heroku 是一个支持多种编程语言的 PaaS(Platform-as-a-Service)。在 2010 年被 Salesforce 收购。Heroku 作为最开始的云平台之一，从 2007 年 6 月起开始开发，当时它仅支持 Ruby，后来增加了对 Java、Node.js、Scala、Clojure、Python 以及 PHP 和 Perl 的支持。</p>\n<h2 id=\"1.heroku基本配置\">1.Heroku基本配置<a title=\"#1.heroku基本配置\" href=\"#1.heroku基本配置\"></a></h2>\n<p>首先，我们需要一个 Heroku 账号，如果你还没有，请自行注册一个，并绑定一张信用卡&amp;借记卡，这里不做多讲。</p>\n<h3 id=\"1.1-安装heroku-cli\">1.1 安装Heroku-cli<a title=\"#1.1-安装heroku-cli\" href=\"#1.1-安装heroku-cli\"></a></h3>\n<p>如果你的设备上已经安装了 Nodejs ，那么可以使用：<code>npm i heroku-cli -g</code>来安装<code>heroku-cli</code></p>\n<p>否则请按照<a href=\"https://devcenter.heroku.com/articles/heroku-cli\" target=\"_blank\">官方文档</a>安装 <code>heroku-cli</code></p>\n<p>安装完成后使用：<code>heroku version</code>来检查是否成功安装，如有类似以下输出则代表安装成功。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> heroku version</span></span><br><span class=\"line\">heroku-cli/7.0.9 android-arm64 node-v12.18.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"1.2-配置heroku-cli\">1.2 配置Heroku-cli<a title=\"#1.2-配置heroku-cli\" href=\"#1.2-配置heroku-cli\"></a></h3>\n<p>安装完成<code>heroku-cli</code>后，使用<code>heroku login -i</code>登陆Heroku，回显如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> heroku login -i</span></span><br><span class=\"line\">heroku: Enter your login credentials</span><br><span class=\"line\">Email: idkzrs@gmail.com</span><br><span class=\"line\">Password: </span><br><span class=\"line\">Two-factor code: </span><br><span class=\"line\">Logged in as idkzrs@gmail.com</span><br></pre></td></tr></table></figure>\n<p>如果以上命令无法登陆，请参考<a href=\"https://blog.zr.ci/posts/herokuclilogin\" target=\"_blank\">解决 Heroku-cli 无法登陆</a></p>\n<p>然后添加 SSH 密钥:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ heroku keys:add</span><br></pre></td></tr></table></figure>\n<h2 id=\"2.部署typecho至heroku\">2.部署Typecho至Heroku<a title=\"#2.部署typecho至heroku\" href=\"#2.部署typecho至heroku\"></a></h2>\n<p>heroku-cli配置完成后就可以开始准备部署了。</p>\n<h3 id=\"2.1-新建-typecho-项目\">2.1 新建 Typecho 项目<a title=\"#2.1-新建-typecho-项目\" href=\"#2.1-新建-typecho-项目\"></a></h3>\n<p>拉取Typecho源码并修改：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/typecho/typecho.git</span><br><span class=\"line\">cd typecho</span><br><span class=\"line\">rm -rf .git* changelog.txt .editorconfig README.md</span><br><span class=\"line\">git clone https://github.com/rvvcim/typecho-on-heroku.git</span><br><span class=\"line\">mv toh/* toh/.htaccess .</span><br><span class=\"line\">rm -rf toh</span><br></pre></td></tr></table></figure>\n<p>初始化Git仓库：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init</span><br><span class=\"line\">git add .</span><br><span class=\"line\">git commit -m &#x27;init heroku-te&#x27;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2.2-新建-heroku-应用\">2.2 新建 Heroku 应用<a title=\"#2.2-新建-heroku-应用\" href=\"#2.2-新建-heroku-应用\"></a></h3>\n<p>这步可以在web操作，也可以使用 heroku-cli 进行配置，这里我使用 cli 来进行操作。<br>\n使用<code>heroku create</code>新建APP，创建成功将会输出类似如下内容:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> heroku create</span></span><br><span class=\"line\">Creating app... done, ⬢ xxxxxx-xxxx-12345</span><br><span class=\"line\">https://xxxxxx-xxxx-12345.herokuapp.com/ | https://git.heroku.com/xxxxxx-xxxx-12345</span><br></pre></td></tr></table></figure>\n<p>其中：<br>\n<code>xxxxxx-xxxx-12345</code>为应用名称<br>\n<code>https://xxxxxx-xxxx-12345.herokuapp.com/</code>为访问链接<br>\n<code>https://git.heroku.com/xxxxxx-xxxx-12345</code>为git仓库</p>\n<p>应用名称可以使用<code>heroku rename</code>进行修改，此操作将会同步修改访问链接和git仓库地址，如：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> heroku rename zr-te</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2.3-设置应用语言\">2.3 设置应用语言<a title=\"#2.3-设置应用语言\" href=\"#2.3-设置应用语言\"></a></h3>\n<p>使用如下命令将应用语言设置为PHP：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">heroku buildpacks:set heroku/php</span><br></pre></td></tr></table></figure>\n<p>若不设置语言可能导致上传时报错</p>\n<h3 id=\"2.3-数据库配置\">2.3 数据库配置<a title=\"#2.3-数据库配置\" href=\"#2.3-数据库配置\"></a></h3>\n<p>Heroku提供了 MySQL 和 PgSQL 两种数据库，以插件形式添加，并各有一定免费额度，两种数据库二选一即可。<br>\n添加MySQL插件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">heroku addons:create jawsdb-maria:kitefin</span><br></pre></td></tr></table></figure>\n<p>添加PgSQL插件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">heroku addons:create heroku-postgresql:hobby-dev</span><br></pre></td></tr></table></figure>\n<p>注：二选一即可，我这里使用MySQL举例。</p>\n<p>添加完 MySQL/PgSQL后，前往<a href=\"https://dashboard.heroku.com/apps\" target=\"_blank\">Heroku管理面板</a>，找到刚才新建的应用，点击导航栏中的<strong>Settings</strong>，找到 <strong>Config Vars</strong> 项，点击<strong>Reveal Config Vars</strong><br>\n<img src=\"/storage/emulated/0/ZR/static/imgs/typechoonheroku/configvars.jpg\" alt=\"\"><br>\n将会显示MySQL/PgSQL连接信息，解析如下：</p>\n<div class=\"φcy\"><div class=\"φda\"><table><thead>\n<tr>\n<th style=\"text-align:center\">NAME</th>\n<th style=\"text-align:center\">KEY</th>\n<th style=\"text-align:center\">VALUE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">MySQL</td>\n<td style=\"text-align:center\">JAWSDB_MARIA_URL</td>\n<td style=\"text-align:center\">mysql://用户名:密码@数据库主机:3306/数据库名称</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">PgSQL</td>\n<td style=\"text-align:center\">DATABASE_URL</td>\n<td style=\"text-align:center\">postgres://用户名:密码@数据库主机:5432/数据库名称</td>\n</tr>\n</tbody>\n</table></div></div><p>修改config.inc.php文件中数据库相关配置：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** 定义MySQL数据库参数 */</span></span><br><span class=\"line\"><span class=\"comment\">/**与下方PgSQL参数无法共存，请选择一项进行填写</span></span><br><span class=\"line\"><span class=\"comment\">$db = new Typecho_Db(&#x27;Pdo_Mysql&#x27;, &#x27;typecho_&#x27;);</span></span><br><span class=\"line\"><span class=\"comment\">$db-&gt;addServer(array (</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;host&#x27; =&gt; &#x27;数据库地址&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;user&#x27; =&gt; &#x27;数据库用户名&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;password&#x27; =&gt; &#x27;数据库密码&#x27;,                                           &#x27;charset&#x27; =&gt; &#x27;utf8mb4&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;port&#x27; =&gt; &#x27;3306&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;database&#x27; =&gt; &#x27;数据库名称&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;engine&#x27; =&gt; &#x27;MyISAM&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">), Typecho_Db::READ | Typecho_Db::WRITE);</span></span><br><span class=\"line\"><span class=\"comment\">Typecho_Db::set($db);        **/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/** 定义PgSQL数据库参数 */</span></span><br><span class=\"line\"><span class=\"comment\">/**与上方MySQL参数无法共存，请选择一项进行填写</span></span><br><span class=\"line\"><span class=\"comment\">$db = new Typecho_Db(&#x27;Pdo_Pgsql&#x27;, &#x27;typecho_&#x27;);</span></span><br><span class=\"line\"><span class=\"comment\">$db-&gt;addServer(array (</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;host&#x27; =&gt; &#x27;数据库地址&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;user&#x27; =&gt; &#x27;数据库用户名&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;password&#x27; =&gt; &#x27;数据库密码&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;charset&#x27; =&gt; &#x27;utf8&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;port&#x27; =&gt; &#x27;5432&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">  &#x27;database&#x27; =&gt; &#x27;数据库名称&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">), Typecho_Db::READ | Typecho_Db::WRITE);</span></span><br><span class=\"line\"><span class=\"comment\">Typecho_Db::set($db);        **/</span></span><br></pre></td></tr></table></figure>\n<p>删除其中一项的注释，并填写相关配置，然后更新git仓库：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\">git commit -m &#x27;update config&#x27;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2.4-推送项目至heroku\">2.4 推送项目至Heroku<a title=\"#2.4-推送项目至heroku\" href=\"#2.4-推送项目至heroku\"></a></h3>\n<p>接下来，使用如下命令将项目推送至Heroku</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push heroku master</span><br></pre></td></tr></table></figure>\n<p>然后打开：https://<code>APP_NAME</code>.herokuapp.com/install.php<br>\n安装typecho</p>\n<h2 id=\"3.绑定域名\">3.绑定域名<a title=\"#3.绑定域名\" href=\"#3.绑定域名\"></a></h2>\n<p>这一步非必须，为可选步骤。<br>\n前往<a href=\"https://dashboard.heroku.com/apps\" target=\"_blank\">Heroku管理面板</a>，找到新建的应用，点击导航栏中的<strong>Settings</strong>，下拉找到<strong>Domains</strong><br>\n点击<strong>Add domains</strong><br>\n<img src=\"/storage/emulated/0/ZR/static/imgs/typechoonheroku/addom.jpg\" alt=\"\"><br>\n<img src=\"/storage/emulated/0/ZR/static/imgs/typechoonheroku/editdom.jpg\" alt=\"\"><br>\n将域名解析至cname地址即可</p>\n<p>Enjoy !</p>\n","next":{"title":"解决 Heroku-cli 无法登陆","link":"posts/herokuclilogin"},"plink":"https://blog.zr.ci/posts/typechoonheroku/","toc":[{"id":"什么是-heroku？","title":"什么是 Heroku？","index":"1"},{"id":"1.heroku基本配置","title":"1.Heroku基本配置","index":"2","children":[{"id":"1.1-安装heroku-cli","title":"1.1 安装Heroku-cli","index":"2.1"},{"id":"1.2-配置heroku-cli","title":"1.2 配置Heroku-cli","index":"2.2"}]},{"id":"2.部署typecho至heroku","title":"2.部署Typecho至Heroku","index":"3","children":[{"id":"2.1-新建-typecho-项目","title":"2.1 新建 Typecho 项目","index":"3.1"},{"id":"2.2-新建-heroku-应用","title":"2.2 新建 Heroku 应用","index":"3.2"},{"id":"2.3-设置应用语言","title":"2.3 设置应用语言","index":"3.3"},{"id":"2.3-数据库配置","title":"2.3 数据库配置","index":"3.4"},{"id":"2.4-推送项目至heroku","title":"2.4 推送项目至Heroku","index":"3.5"}]},{"id":"3.绑定域名","title":"3.绑定域名","index":"4"}],"copyright":{"author":"箴扰","link":"<a href=\"https://blog.zr.ci/posts/typechoonheroku/\" title=\"Heroku部署安装Typecho\">https://blog.zr.ci/posts/typechoonheroku/</a>","license":"本博客所有文章除特别声明外，均采用(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>)许可协议，转载请注明来源<a href=\"https://blog.zr.ci\" rel=\"nofollow\" target=\"_blank\">箴扰</a>！"}}