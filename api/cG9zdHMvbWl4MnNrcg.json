{"title":"小米MIX 2S System分区扩容","date":"2020-08-09T14:11:00.000Z","date_formatted":{"ll":"2020年8月9日","L":"2020/08/09","MM-DD":"08-09"},"thumbnail":"https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/mix2skr/cover.png","color":"#111","link":"posts/mix2skr","comments":true,"tags":["Android"],"categories":["瞎折腾"],"updated":"2020-08-15T14:11:00.000Z","content":"<h2 id=\"前言：\">前言：<a title=\"#前言：\" href=\"#前言：\"></a></h2>\n<p>由于MIX 2s的System分区过小，导致部分gsi无法刷入，故扩容分区，顺便制作为卡刷包方便使用。</p>\n<a id=\"more\"></a>\n<h2 id=\"设备要求：\">设备要求：<a title=\"#设备要求：\" href=\"#设备要求：\"></a></h2>\n<p>i：确保您的设备为小米MIX 2s<br>\nii：设备已解除BL锁并拥有第三方Recovery</p>\n<h2 id=\"有损扩容\">有损扩容<a title=\"#有损扩容\" href=\"#有损扩容\"></a></h2>\n<h3 id=\"使用方法：\">使用方法：<a title=\"#使用方法：\" href=\"#使用方法：\"></a></h3>\n<p>i：下载本人提供的 MIX2s_5GB_System.zip 文件<br>\nii：重启至Recovery<br>\niii：找到 MIX2s_5GB_System.zip 并刷入<br>\niv:重启至Recovery，格式化： System,Vendor,Data</p>\n<p>注意：由于会清除 System,Vendor,Data 三个分区的数据，请提前备份您的所有重要数据，如果您的身边没有电脑或其它存储设备，请下载 los 的ROM并复制到 /cust 目录一份，方便刷入。</p>\n<h3 id=\"原理：\">原理：<a title=\"#原理：\" href=\"#原理：\"></a></h3>\n<p>使用sgdisk对磁盘进行重新分区</p>\n<h3 id=\"常见问题：\">常见问题：<a title=\"#常见问题：\" href=\"#常见问题：\"></a></h3>\n<p>Q:扩容之后可以还原吗？<br>\nA:可以，刷一次3GB的文件即可还原。另：如果已经扩容分区，之后想更换其它的大小的分区，请务必先还原。<br>\nQ:扩容之后可以刷官方ROM吗？<br>\nA:可以，但是需要注意官方有dm校验，不去除会卡第一屏，可以通过同时刷入magisk去除。<br>\nQ:扩容之后可以线刷吗？<br>\nA:可以，但不推荐这样做，如果需要线刷，请勿勾选锁定选项，否则可能会导致需要售后解决。<br>\nQ:为什么我扩容之后刷入ROM却显示System大小为3GB<br>\nA:这是因为ROM打包时是按照3GB大小打包的，请前往Recovery，点击：分区管理 - System - 调整分区大小。Vendor分区同理。</p>\n<h2 id=\"无损扩容\">无损扩容<a title=\"#无损扩容\" href=\"#无损扩容\"></a></h2>\n<p>此方法极度危险，并且不推荐使用，如果您没有相关经验，请谨慎。<br>\n手机重启至第三方Recovery连接电脑，下载我提供的无损扩容文件<br>\n解压并进入目录,按 Shift+右键 选择打开Powershell<br>\n输入以下命令（此处为win10）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">./adb push sgdisk /sbin</span><br><span class=\"line\">./adb shell</span><br><span class=\"line\">comod 0777 /sbin/sgdisk</span><br><span class=\"line\"></span><br><span class=\"line\">sgdisk --delete=18 /dev/block/sda</span><br><span class=\"line\">sgdisk --delete=19 /dev/block/sda</span><br><span class=\"line\">sgdisk --delete=20 /dev/block/sda</span><br><span class=\"line\">sgdisk --delete=47 /dev/block/sde</span><br><span class=\"line\">sgdisk --delete=48 /dev/block/sde</span><br><span class=\"line\"></span><br><span class=\"line\">sgdisk --new 0:0:+1024M --change-name=18:vendor --typecode=18:97D7B011-54DA-4835-B3C4-917AD6E73D74 /dev/block/sda</span><br><span class=\"line\">sgdisk --new 0:0:+64M --change-name=19:recovery --typecode=19:9D72D4E4-9958-42DA-AC26-BEA7A90B0434 /dev/block/sda</span><br><span class=\"line\">sgdisk --new 0:0:0 --change-name=20:cache --typecode=20:5594C694-C871-4B5F-90B1-690A6F68E0F7 /dev/block/sda</span><br><span class=\"line\">sgdisk --new 0:0:+512M --change-name=47:cust --typecode=47:C3008246-512A-4FEB-8A51-068FA4AD5F6D /dev/block/sde</span><br><span class=\"line\">sgdisk --new 0:0:0 --change-name=48:system --typecode=48:97D7B011-54DA-4835-B3C4-917AD6E73D74 /dev/block/sde</span><br><span class=\"line\"></span><br><span class=\"line\">reboot bootloader</span><br></pre></td></tr></table></figure>\n<p>此时手机将重启至fastboot，保持设备连接，在Powershell中输入：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./fastboot flash recovery recovery.img</span><br><span class=\"line\">./fastboot boot recovery.img</span><br></pre></td></tr></table></figure>\n<p>不出意外，您的手机将重启至Recovery ，请保持设备连接。<br>\n在Powershell中输入：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./adb shell</span><br><span class=\"line\"></span><br><span class=\"line\">mke2fs -t ext4 -b 4096 /dev/block/sde47</span><br><span class=\"line\">mke2fs -t ext4 -b 4096 /dev/block/sda18</span><br><span class=\"line\">e2fsdroid -e -S /file_contexts -a /vendor /dev/block/sda18</span><br><span class=\"line\">mke2fs -t ext4 -b 4096 /dev/block/sda20</span><br><span class=\"line\">e2fsdroid -e -S /file_contexts -a /cache /dev/block/sda20</span><br><span class=\"line\">mke2fs -t ext4 -b 4096 /dev/block/sde48</span><br><span class=\"line\">e2fsdroid -e -S /file_contexts -a / /dev/block/sde48</span><br><span class=\"line\">reboot recovery</span><br></pre></td></tr></table></figure>\n<p>并在Recovery中格式化： System,Vendor,Data,Cache<br>\n至此，扩容完成。</p>\n<p>下方是本人执行扩容时的回显内容，可以参考。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\platform-tools&gt; ./adb push sgdisk /sbin</span><br><span class=\"line\">PS C:\\platform-tools&gt; ./adb shell</span><br><span class=\"line\">sh-5.0# chmod 0777 /sbin/sgdisk</span><br><span class=\"line\">sh-5.0# sgdisk --delete=18 /dev/block/sda</span><br><span class=\"line\">Warning: The kernel is still using the old partition table.</span><br><span class=\"line\">The new table will be used at the next reboot.</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --delete=19 /dev/block/sda</span><br><span class=\"line\">Warning: The kernel is still using the old partition table.</span><br><span class=\"line\">The new table will be used at the next reboot.</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --delete=20 /dev/block/sda</span><br><span class=\"line\">Warning: The kernel is still using the old partition table.</span><br><span class=\"line\">The new table will be used at the next reboot.</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --delete=47 /dev/block/sde</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --delete=48 /dev/block/sde</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --new 0:0:+1024M --change-name=18:vendor --typecode=18:97D7B011-54DA-4835-B3C4-917AD6E73D74 /dev/block/&gt;</span><br><span class=\"line\">Setting name!</span><br><span class=\"line\">partNum is 17</span><br><span class=\"line\">REALLY setting name!</span><br><span class=\"line\">Warning: The kernel is still using the old partition table.</span><br><span class=\"line\">The new table will be used at the next reboot.</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\"></span><br><span class=\"line\">sh-5.0# sgdisk --new 0:0:+64M --change-name=19:recovery --typecode=19:9D72D4E4-9958-42DA-AC26-BEA7A90B0434 /dev/block/&gt;</span><br><span class=\"line\">Setting name!</span><br><span class=\"line\">partNum is 18</span><br><span class=\"line\">REALLY setting name!</span><br><span class=\"line\">Warning: The kernel is still using the old partition table.</span><br><span class=\"line\">The new table will be used at the next reboot.</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --new 0:0:+0 --change-name=20:cache --typecode=20:5594C694-C871-4B5F-90B1-690A6F68E0F7 /dev/block/sda</span><br><span class=\"line\">Setting name!</span><br><span class=\"line\">partNum is 19</span><br><span class=\"line\">REALLY setting name!</span><br><span class=\"line\">Warning: The kernel is still using the old partition table.</span><br><span class=\"line\">The new table will be used at the next reboot.</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\"></span><br><span class=\"line\">sh-5.0# sgdisk --new 0:0:+512M --change-name=47:cust --typecode=47:C3008246-512A-4FEB-8A51-068FA4AD5F6D /dev/block/sde</span><br><span class=\"line\">Setting name!</span><br><span class=\"line\">partNum is 46</span><br><span class=\"line\">REALLY setting name!</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --new 0:0:0 --change-name=48:system --typecode=48:97D7B011-54DA-4835-B3C4-917AD6E73D74 /dev/block/sde</span><br><span class=\"line\">Setting name!</span><br><span class=\"line\">partNum is 47</span><br><span class=\"line\">REALLY setting name!</span><br><span class=\"line\">The operation has completed successfully.</span><br><span class=\"line\">sh-5.0# sgdisk --print /dev/block/sde</span><br><span class=\"line\">Disk /dev/block/sde: 1179648 sectors, 4.5 GiB</span><br><span class=\"line\">Logical sector size: 4096 bytes</span><br><span class=\"line\">Disk identifier (GUID): A9708BF8-6148-6573-F93F-EF3C911FC364</span><br><span class=\"line\">Partition table holds up to 64 entries</span><br><span class=\"line\">First usable sector is 6, last usable sector is 1179642</span><br><span class=\"line\">Partitions will be aligned on 2-sector boundaries</span><br><span class=\"line\">Total free space is 16379 sectors (64.0 MiB)</span><br><span class=\"line\"></span><br><span class=\"line\">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class=\"line\">   1               6              13   32.0 KiB    FFFF  sec</span><br><span class=\"line\">   2              14              21   32.0 KiB    FFFF  limits</span><br><span class=\"line\">   3              22              63   168.0 KiB   FFFF  bk41</span><br><span class=\"line\">   4              64              95   128.0 KiB   FFFF  qupfw_a</span><br><span class=\"line\">   5              96             127   128.0 KiB   FFFF  qupfw_b</span><br><span class=\"line\">   6             128             191   256.0 KiB   FFFF  apdp</span><br><span class=\"line\">   7             192             255   256.0 KiB   FFFF  msadp</span><br><span class=\"line\">   8             256             287   128.0 KiB   FFFF  vbmeta</span><br><span class=\"line\">   9             288             319   128.0 KiB   FFFF  bk42</span><br><span class=\"line\">  10             320             351   128.0 KiB   FFFF  storsec_a</span><br><span class=\"line\">  11             352             383   128.0 KiB   FFFF  storsec_b</span><br><span class=\"line\">  12             384             447   256.0 KiB   FFFF  devcfg_a</span><br><span class=\"line\">  13             448             511   256.0 KiB   FFFF  devcfg_b</span><br><span class=\"line\">  14             512             639   512.0 KiB   FFFF  aop_a</span><br><span class=\"line\">  15             640             767   512.0 KiB   FFFF  aop_b</span><br><span class=\"line\">  16             768             895   512.0 KiB   FFFF  bk43</span><br><span class=\"line\">  17             896            1023   512.0 KiB   FFFF  bk44</span><br><span class=\"line\">  18            1024            1279   1024.0 KiB  FFFF  cmnlib_a</span><br><span class=\"line\">  19            1280            1535   1024.0 KiB  FFFF  cmnlib_b</span><br><span class=\"line\">  20            1536            1791   1024.0 KiB  FFFF  cmnlib64_a</span><br><span class=\"line\">  21            1792            2047   1024.0 KiB  FFFF  cmnlib64_b</span><br><span class=\"line\">  22            2048            2303   1024.0 KiB  FFFF  keymaster_a</span><br><span class=\"line\">  23            2304            2559   1024.0 KiB  FFFF  keymaster_b</span><br><span class=\"line\">  24            2560            2815   1024.0 KiB  FFFF  bluetooth</span><br><span class=\"line\">  25            2816            3071   1024.0 KiB  FFFF  bk45</span><br><span class=\"line\">  26            3072            3327   1024.0 KiB  FFFF  hyp_a</span><br><span class=\"line\">  27            3328            3583   1024.0 KiB  FFFF  hyp_b</span><br><span class=\"line\">  28            3584            3839   1024.0 KiB  FFFF  dip</span><br><span class=\"line\">  29            3840            4095   1024.0 KiB  FFFF  bk46</span><br><span class=\"line\">  30            4096            4607   2.0 MiB     FFFF  sti</span><br><span class=\"line\">  31            4608            5119   2.0 MiB     FFFF  toolsfv</span><br><span class=\"line\">  32            5120            5631   2.0 MiB     FFFF  abl_a</span><br><span class=\"line\">  33            5632            6143   2.0 MiB     FFFF  abl_b</span><br><span class=\"line\">  34            6144            7167   4.0 MiB     FFFF  tz_a</span><br><span class=\"line\">  35            7168            8191   4.0 MiB     FFFF  tz_b</span><br><span class=\"line\">  36            8192           10239   8.0 MiB     FFFF  fsg</span><br><span class=\"line\">  37           10240           12287   8.0 MiB     FFFF  dtbo</span><br><span class=\"line\">  38           12288           14335   8.0 MiB     FFFF  bk47</span><br><span class=\"line\">  39           14336           16383   8.0 MiB     FFFF  spunvm</span><br><span class=\"line\">  40           16384           20479   16.0 MiB    FFFF  bk48</span><br><span class=\"line\">  41           20480           24575   16.0 MiB    FFFF  bk49</span><br><span class=\"line\">  42           24576           32767   32.0 MiB    FFFF  splash</span><br><span class=\"line\">  43           32768           40959   32.0 MiB    FFFF  logo</span><br><span class=\"line\">  44           40960           49151   32.0 MiB    FFFF  dsp</span><br><span class=\"line\">  45           49152           65535   64.0 MiB    FFFF  boot</span><br><span class=\"line\">  46           65536          114687   192.0 MiB   0700  modem</span><br><span class=\"line\">  47          114688          245759   512.0 MiB   FFFF  cust</span><br><span class=\"line\">  48          245760         1163263   3.5 GiB     FFFF  system</span><br><span class=\"line\">  49         1163264         1179642   64.0 MiB    FFFF  last_parti</span><br><span class=\"line\">sh-5.0#</span><br></pre></td></tr></table></figure>\n<h2 id=\"免责声明：\">免责声明：<a title=\"#免责声明：\" href=\"#免责声明：\"></a></h2>\n<p>i：本人仅提供扩容文件，不对使用文件后造成的如：数据丢失、硬件损坏等后果负责。<br>\nii：您必须明白并且承担使用文件后所造成的后果。<br>\niii：如不同意以上内容请不要使用本文件。</p>\n<p>扩容文件：<br>\nLink：<a href=\"https://pans.lanzous.com/b0dq5x2ni\" target=\"_blank\">https://pans.lanzous.com/b0dq5x2ni</a><br>\nKey:idkzr<br>\n扩容视频：<br>\n<a href=\"http://www.bilibili.com/video/BV1gK411T74X\" target=\"_blank\">http://www.bilibili.com/video/BV1gK411T74X</a></p>\n","prev":{"title":"解决 Heroku-cli 无法登陆","link":"posts/herokuclilogin"},"next":{"title":"碎片化信息","link":"posts/sphxx"},"plink":"https://blog.zr.ci/posts/mix2skr/","toc":[{"id":"前言：","title":"前言：","index":"1"},{"id":"设备要求：","title":"设备要求：","index":"2"},{"id":"有损扩容","title":"有损扩容","index":"3","children":[{"id":"使用方法：","title":"使用方法：","index":"3.1"},{"id":"原理：","title":"原理：","index":"3.2"},{"id":"常见问题：","title":"常见问题：","index":"3.3"}]},{"id":"无损扩容","title":"无损扩容","index":"4"},{"id":"免责声明：","title":"免责声明：","index":"5"}],"copyright":{"author":"箴扰","link":"<a href=\"https://blog.zr.ci/posts/mix2skr/\" title=\"小米MIX 2S System分区扩容\">https://blog.zr.ci/posts/mix2skr/</a>","license":"本博客所有文章除特别声明外，均采用(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>)许可协议，转载请注明来源<a href=\"https://blog.zr.ci\" rel=\"nofollow\" target=\"_blank\">箴扰</a>！"}}