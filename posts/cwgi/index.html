<!DOCTYPE html><html lang="zh-Hans"><head>
<meta charset="utf-8">
<title>利用Cloudflare Workers 制作Google镜像站 - 无名小筑</title>
<base href="/">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<link rel="canonical" href="https://blog.zr.ci/posts/cwgi/">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="今天在gayhub上面闲逛，发现了一个利用Cloudflare Workers 制作Google镜像站的方法。">
<meta property="og:type" content="website">
<meta property="og:title" content="利用Cloudflare Workers 制作Google镜像站">
<meta property="og:url" content="https://blog.zr.ci/posts/cwgi/index.html">
<meta property="og:site_name" content="无名小筑">
<meta property="og:description" content="今天在gayhub上面闲逛，发现了一个利用Cloudflare Workers 制作Google镜像站的方法。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cover.jpg">
<meta property="article:published_time" content="2020-05-01T14:11:00.000Z">
<meta property="article:modified_time" content="2020-05-01T14:11:00.000Z">
<meta property="article:author" content="箴扰">
<meta property="article:tag" content="web">
<meta property="article:tag" content="Workers">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cover.jpg">
<script type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","publisher":{"@type":"Person","name":"箴扰","description":"分别便是为了重逢","image":"https://www.gravatar.com/avatar/6a610305a94f20a4f2212eb510dc98b9?s=160"},"url":"https://blog.zr.ci","image":"https://www.gravatar.com/avatar/6a610305a94f20a4f2212eb510dc98b9?s=160","description":"无名小筑，一个简简单单的博客，拿来记录一下生活，博主日常咕咕咕。","author":{"@type":"Person","name":"箴扰","description":"分别便是为了重逢","image":"https://www.gravatar.com/avatar/6a610305a94f20a4f2212eb510dc98b9?s=160"},"inLanguage":{"@type":"Language","alternateName":"zh-Hans"}},{"@context":"http://schema.org","@type":"Article","articleSection":"瞎折腾","url":"https://blog.zr.ci/posts/cwgi.html","headline":"利用Cloudflare Workers 制作Google镜像站","image":"https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cover.jpg","datePublished":"2020-05-01T14:11:00.000Z","dateModified":"2020-05-01T14:11:00.000Z","keywords":"web,Workers","description":"今天在gayhub上面闲逛，发现了一个利用Cloudflare Workers 制作Google镜像站的方法。","publisher":{"@type":"Organization","name":"无名小筑","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/6a610305a94f20a4f2212eb510dc98b9?s=160"}},"author":{"@type":"Person","name":"箴扰","description":"分别便是为了重逢","image":"https://www.gravatar.com/avatar/6a610305a94f20a4f2212eb510dc98b9?s=160"},"inLanguage":{"@type":"Language","alternateName":"zh-Hans"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.zr.ci/posts/cwgi.html"},"thumbnailUrl":"https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cover.jpg"}]</script><link rel="alternate" type="application/atom+xml" title="无名小筑" href="/atom.xml">
<link href="//fonts.googleapis.com/css?family=Baloo+Bhaijaan|Inconsolata|Josefin+Sans|Montserrat" rel="stylesheet"><link href="/styles.43478ea7e28ed563c48b.css" rel="stylesheet">
<link rel="stylesheet" href="/theme.28760e21272c7fb12812.css" is="theme">

<script src="/config.cbc92a5068011152d161.js"></script>

<meta name="generator" content="Hexo 5.2.0"><meta name="theme-color" content="#111"><script type="application/json" is="state">{&q;api/cG9zdHMvY3dnaQ.json&q;:{&q;title&q;:&q;利用Cloudflare Workers 制作Google镜像站&q;,&q;date&q;:&q;2020-05-01T14:11:00.000Z&q;,&q;date_formatted&q;:{&q;ll&q;:&q;2020年5月1日&q;,&q;L&q;:&q;2020/05/01&q;,&q;MM-DD&q;:&q;05-01&q;},&q;thumbnail&q;:&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cover.jpg&q;,&q;color&q;:&q;#111&q;,&q;link&q;:&q;posts/cwgi&q;,&q;comments&q;:true,&q;tags&q;:[&q;Workers&q;,&q;web&q;],&q;categories&q;:[&q;瞎折腾&q;],&q;updated&q;:&q;2020-05-01T14:11:00.000Z&q;,&q;content&q;:&q;&l;p&g;今天在gayhub上面闲逛，发现了一个利用Cloudflare Workers 制作Google镜像站的方法。&l;/p&g;\n&l;a id=\&q;more\&q;&g;&l;/a&g;\n&l;p&g;Cloudflare Workers是什么各位可以自行搜索，这里不做过多介绍。&l;/p&g;\n&l;h2 id=\&q;新建-workers\&q;&g;新建 Workers&l;a title=\&q;#新建-workers\&q; href=\&q;#新建-workers\&q;&g;&l;/a&g;&l;/h2&g;\n&l;h3 id=\&q;登陆cf之后点击-workers\&q;&g;登陆cf之后点击 Workers&l;a title=\&q;#登陆cf之后点击-workers\&q; href=\&q;#登陆cf之后点击-workers\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/xjcw.jpg\&q; alt=\&q;xjcw\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;h3 id=\&q;创建子域名\&q;&g;创建子域名&l;a title=\&q;#创建子域名\&q; href=\&q;#创建子域名\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/xjzym.jpg\&q; alt=\&q;xjzym\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;h3 id=\&q;点击创建-workers\&q;&g;点击创建 Workers&l;a title=\&q;#点击创建-workers\&q; href=\&q;#点击创建-workers\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cjcw.jpg\&q; alt=\&q;cjcw\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;h2 id=\&q;部署代码\&q;&g;部署代码&l;a title=\&q;#部署代码\&q; href=\&q;#部署代码\&q;&g;&l;/a&g;&l;/h2&g;\n&l;h3 id=\&q;编辑workers\&q;&g;编辑Workers&l;a title=\&q;#编辑workers\&q; href=\&q;#编辑workers\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;将以下代码粘贴至代码框&l;/p&g;\n&l;figure class=\&q;highlight js\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;2&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;3&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;4&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;5&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;6&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;7&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;8&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;9&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;10&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;11&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;12&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;13&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;14&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;15&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;16&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;17&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;18&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;19&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;20&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;21&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;22&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;23&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;24&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;25&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;26&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;27&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;28&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;29&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;30&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;31&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;32&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;33&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;34&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;35&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;36&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;37&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;38&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;39&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;40&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;41&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;42&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;43&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;44&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;45&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;46&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;47&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;48&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;49&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;50&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;51&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;52&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;53&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;54&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;55&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;56&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;57&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;58&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;59&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;60&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;61&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;62&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;63&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;64&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;65&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;66&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;67&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;68&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;69&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;70&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;71&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;72&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;73&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;74&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;75&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;76&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;77&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;78&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;79&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;80&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;81&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;82&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;83&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;84&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;85&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;86&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;87&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;88&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;89&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;90&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;91&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;92&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;93&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;94&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;95&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;96&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;97&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;98&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;99&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;100&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;101&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;102&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;103&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;104&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;105&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;106&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;107&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;108&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;109&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;110&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;111&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;112&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;113&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;114&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;115&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;116&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;117&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;118&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;119&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;120&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;121&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;122&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;123&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;124&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;125&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;126&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;127&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;128&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;129&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;130&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;131&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;132&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;133&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;134&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;135&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;136&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;137&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;138&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;139&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;140&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;141&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;142&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;143&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;144&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;145&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;146&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;147&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;148&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;149&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;150&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;151&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;152&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// Website you intended to retrieve for users.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; upstream = &l;span class=\&q;string\&q;&g;&a;#x27;www.google.com&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// Custom pathname for the upstream website.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; upstream_path = &l;span class=\&q;string\&q;&g;&a;#x27;/&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// Website you intended to retrieve for users using mobile devices.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; upstream_mobile = &l;span class=\&q;string\&q;&g;&a;#x27;www.google.com&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// Countries and regions where you wish to suspend your service.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; blocked_region = [&l;span class=\&q;string\&q;&g;&a;#x27;KP&a;#x27;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;#x27;SY&a;#x27;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;#x27;PK&a;#x27;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;#x27;CU&a;#x27;&l;/span&g;]&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// IP addresses which you wish to block from using your service.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; blocked_ip_address = [&l;span class=\&q;string\&q;&g;&a;#x27;0.0.0.0&a;#x27;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;#x27;127.0.0.1&a;#x27;&l;/span&g;]&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// Whether to use HTTPS protocol for upstream address.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; https = &l;span class=\&q;literal\&q;&g;true&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// Whether to disable cache.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; disable_cache = &l;span class=\&q;literal\&q;&g;true&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;comment\&q;&g;// Replace texts.&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;const&l;/span&g; replace_dict = &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;string\&q;&g;&a;#x27;$upstream&a;#x27;&l;/span&g;: &l;span class=\&q;string\&q;&g;&a;#x27;$custom_domain&a;#x27;&l;/span&g;,&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;string\&q;&g;&a;#x27;//google.com&a;#x27;&l;/span&g;: &l;span class=\&q;string\&q;&g;&a;#x27;&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;addEventListener(&l;span class=\&q;string\&q;&g;&a;#x27;fetch&a;#x27;&l;/span&g;, &l;span class=\&q;function\&q;&g;&l;span class=\&q;params\&q;&g;event&l;/span&g; =&a;gt;&l;/span&g; &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    event.respondWith(fetchAndApply(event.request));&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&a;#125;)&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;async&l;/span&g; &l;span class=\&q;function\&q;&g;&l;span class=\&q;keyword\&q;&g;function&l;/span&g; &l;span class=\&q;title\&q;&g;fetchAndApply&l;/span&g;(&l;span class=\&q;params\&q;&g;request&l;/span&g;) &l;/span&g;&a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;const&l;/span&g; region = request.headers.get(&l;span class=\&q;string\&q;&g;&a;#x27;cf-ipcountry&a;#x27;&l;/span&g;).toUpperCase();&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;const&l;/span&g; ip_address = request.headers.get(&l;span class=\&q;string\&q;&g;&a;#x27;cf-connecting-ip&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;const&l;/span&g; user_agent = request.headers.get(&l;span class=\&q;string\&q;&g;&a;#x27;user-agent&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;let&l;/span&g; response = &l;span class=\&q;literal\&q;&g;null&l;/span&g;;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;let&l;/span&g; url = &l;span class=\&q;keyword\&q;&g;new&l;/span&g; URL(request.url);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;let&l;/span&g; url_hostname = url.hostname;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (https == &l;span class=\&q;literal\&q;&g;true&l;/span&g;) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        url.protocol = &l;span class=\&q;string\&q;&g;&a;#x27;https:&a;#x27;&l;/span&g;;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        url.protocol = &l;span class=\&q;string\&q;&g;&a;#x27;http:&a;#x27;&l;/span&g;;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (&l;span class=\&q;keyword\&q;&g;await&l;/span&g; device_status(user_agent)) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;var&l;/span&g; upstream_domain = upstream;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;var&l;/span&g; upstream_domain = upstream_mobile;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    url.host = upstream_domain;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (url.pathname == &l;span class=\&q;string\&q;&g;&a;#x27;/&a;#x27;&l;/span&g;) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        url.pathname = upstream_path;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        url.pathname = upstream_path + url.pathname;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (blocked_region.includes(region)) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        response = &l;span class=\&q;keyword\&q;&g;new&l;/span&g; Response(&l;span class=\&q;string\&q;&g;&a;#x27;Access denied: WorkersProxy is not available in your region yet.&a;#x27;&l;/span&g;, &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            status: &l;span class=\&q;number\&q;&g;403&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (blocked_ip_address.includes(ip_address)) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        response = &l;span class=\&q;keyword\&q;&g;new&l;/span&g; Response(&l;span class=\&q;string\&q;&g;&a;#x27;Access denied: Your IP address is blocked by WorkersProxy.&a;#x27;&l;/span&g;, &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            status: &l;span class=\&q;number\&q;&g;403&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; method = request.method;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; request_headers = request.headers;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; new_request_headers = &l;span class=\&q;keyword\&q;&g;new&l;/span&g; Headers(request_headers);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        new_request_headers.set(&l;span class=\&q;string\&q;&g;&a;#x27;Host&a;#x27;&l;/span&g;, url.hostname);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        new_request_headers.set(&l;span class=\&q;string\&q;&g;&a;#x27;Referer&a;#x27;&l;/span&g;, url.hostname);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; original_response = &l;span class=\&q;keyword\&q;&g;await&l;/span&g; fetch(url.href, &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            method: method,&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            headers: new_request_headers&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;)&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; original_response_clone = original_response.clone();&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; original_text = &l;span class=\&q;literal\&q;&g;null&l;/span&g;;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; response_headers = original_response.headers;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; new_response_headers = &l;span class=\&q;keyword\&q;&g;new&l;/span&g; Headers(response_headers);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; status = original_response.status;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (disable_cache) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            new_response_headers.set(&l;span class=\&q;string\&q;&g;&a;#x27;Cache-Control&a;#x27;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;#x27;no-store&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        new_response_headers.set(&l;span class=\&q;string\&q;&g;&a;#x27;access-control-allow-origin&a;#x27;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;#x27;*&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        new_response_headers.set(&l;span class=\&q;string\&q;&g;&a;#x27;access-control-allow-credentials&a;#x27;&l;/span&g;, &l;span class=\&q;literal\&q;&g;true&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        new_response_headers.delete(&l;span class=\&q;string\&q;&g;&a;#x27;content-security-policy&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        new_response_headers.delete(&l;span class=\&q;string\&q;&g;&a;#x27;content-security-policy-report-only&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        new_response_headers.delete(&l;span class=\&q;string\&q;&g;&a;#x27;clear-site-data&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;if&l;/span&g;(new_response_headers.get(&l;span class=\&q;string\&q;&g;&a;quot;x-pjax-url&a;quot;&l;/span&g;)) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            new_response_headers.set(&l;span class=\&q;string\&q;&g;&a;quot;x-pjax-url&a;quot;&l;/span&g;, response_headers.get(&l;span class=\&q;string\&q;&g;&a;quot;x-pjax-url&a;quot;&l;/span&g;).replace(&l;span class=\&q;string\&q;&g;&a;quot;//&a;quot;&l;/span&g; + upstream_domain, &l;span class=\&q;string\&q;&g;&a;quot;//&a;quot;&l;/span&g; + url_hostname));&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;const&l;/span&g; content_type = new_response_headers.get(&l;span class=\&q;string\&q;&g;&a;#x27;content-type&a;#x27;&l;/span&g;);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (content_type.includes(&l;span class=\&q;string\&q;&g;&a;#x27;text/html&a;#x27;&l;/span&g;) &a;amp;&a;amp; content_type.includes(&l;span class=\&q;string\&q;&g;&a;#x27;UTF-8&a;#x27;&l;/span&g;)) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            original_text = &l;span class=\&q;keyword\&q;&g;await&l;/span&g; replace_response_text(original_response_clone, upstream_domain, url_hostname);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            original_text = original_response_clone.body&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        response = &l;span class=\&q;keyword\&q;&g;new&l;/span&g; Response(original_text, &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            status,&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            headers: new_response_headers&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;)&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;return&l;/span&g; response;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;async&l;/span&g; &l;span class=\&q;function\&q;&g;&l;span class=\&q;keyword\&q;&g;function&l;/span&g; &l;span class=\&q;title\&q;&g;replace_response_text&l;/span&g;(&l;span class=\&q;params\&q;&g;response, upstream_domain, host_name&l;/span&g;) &l;/span&g;&a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;let&l;/span&g; text = &l;span class=\&q;keyword\&q;&g;await&l;/span&g; response.text()&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;var&l;/span&g; i, j;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;for&l;/span&g; (i &l;span class=\&q;keyword\&q;&g;in&l;/span&g; replace_dict) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        j = replace_dict[i]&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (i == &l;span class=\&q;string\&q;&g;&a;#x27;$upstream&a;#x27;&l;/span&g;) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            i = upstream_domain&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (i == &l;span class=\&q;string\&q;&g;&a;#x27;$custom_domain&a;#x27;&l;/span&g;) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            i = host_name&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (j == &l;span class=\&q;string\&q;&g;&a;#x27;$upstream&a;#x27;&l;/span&g;) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            j = upstream_domain&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125; &l;span class=\&q;keyword\&q;&g;else&l;/span&g; &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (j == &l;span class=\&q;string\&q;&g;&a;#x27;$custom_domain&a;#x27;&l;/span&g;) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            j = host_name&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;let&l;/span&g; re = &l;span class=\&q;keyword\&q;&g;new&l;/span&g; &l;span class=\&q;built_in\&q;&g;RegExp&l;/span&g;(i, &l;span class=\&q;string\&q;&g;&a;#x27;g&a;#x27;&l;/span&g;)&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        text = text.replace(re, j);&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;return&l;/span&g; text;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;keyword\&q;&g;async&l;/span&g; &l;span class=\&q;function\&q;&g;&l;span class=\&q;keyword\&q;&g;function&l;/span&g; &l;span class=\&q;title\&q;&g;device_status&l;/span&g;(&l;span class=\&q;params\&q;&g;user_agent_info&l;/span&g;) &l;/span&g;&a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;var&l;/span&g; agents = [&l;span class=\&q;string\&q;&g;&a;quot;Android&a;quot;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;quot;iPhone&a;quot;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;quot;SymbianOS&a;quot;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;quot;Windows Phone&a;quot;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;quot;iPad&a;quot;&l;/span&g;, &l;span class=\&q;string\&q;&g;&a;quot;iPod&a;quot;&l;/span&g;];&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;var&l;/span&g; flag = &l;span class=\&q;literal\&q;&g;true&l;/span&g;;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;for&l;/span&g; (&l;span class=\&q;keyword\&q;&g;var&l;/span&g; v = &l;span class=\&q;number\&q;&g;0&l;/span&g;; v &a;lt; agents.length; v++) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &l;span class=\&q;keyword\&q;&g;if&l;/span&g; (user_agent_info.indexOf(agents[v]) &a;gt; &l;span class=\&q;number\&q;&g;0&l;/span&g;) &a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            flag = &l;span class=\&q;literal\&q;&g;false&l;/span&g;;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;            &l;span class=\&q;keyword\&q;&g;break&l;/span&g;;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;        &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;keyword\&q;&g;return&l;/span&g; flag;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&a;#125;&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;p&g;点击左上角修改项目名（可选）&l;br&g;\n点击右下角保存并部署&l;/p&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/xgdm.jpg\&q; alt=\&q;xgdm\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;p&g;确认部署&l;/p&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/bs.jpg\&q; alt=\&q;bs\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;p&g;点击预览查看&l;/p&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/yl.jpg\&q; alt=\&q;yl\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;h2 id=\&q;绑定域名\&q;&g;绑定域名&l;a title=\&q;#绑定域名\&q; href=\&q;#绑定域名\&q;&g;&l;/a&g;&l;/h2&g;\n&l;h3 id=\&q;添加路由\&q;&g;添加路由&l;a title=\&q;#添加路由\&q; href=\&q;#添加路由\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;回到域名管理，选择你的域名&l;/p&g;\n&l;p&g;点击Workers，点击添加路由&l;/p&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/ly.jpg\&q; alt=\&q;ly\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;p&g;路由填写你需要解析的域名，Workers选择刚刚新建的Workers项目名&l;br&g;\n我这里以&l;code&g;gogoogle.ml&l;/code&g;举例，注意在域名后面填写&l;code&g;/*&l;/code&g;&l;/p&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/qr.jpg\&q; alt=\&q;qr\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;h3 id=\&q;添加解析\&q;&g;添加解析&l;a title=\&q;#添加解析\&q; href=\&q;#添加解析\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;这个是可以随便填写的，无论你写的什么，cf都会绑定到Workers上面&l;/p&g;\n&l;p&g;&l;img src=\&q;https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/jx.jpg\&q; alt=\&q;jx\&q; class=\&q;φcx\&q;&g;&l;/p&g;\n&l;h2 id=\&q;预览\&q;&g;预览&l;a title=\&q;#预览\&q; href=\&q;#预览\&q;&g;&l;/a&g;&l;/h2&g;\n&l;p&g;!!!&l;/p&g;\n&l;center&g;\n[btnyellow href=\&q;http://gogoogle.ml/\&q; target=\&q;blank\&q;]点击预览[/btnyellow]&l;/center&g;\n!!!\n&q;,&q;prev&q;:{&q;title&q;:&q;盘点那些数量繁多的USB接口&q;,&q;link&q;:&q;posts/usbjk&q;},&q;next&q;:{&q;title&q;:&q;盘点一下那些我用过的免费CDN&q;,&q;link&q;:&q;posts/freecdn&q;},&q;plink&q;:&q;https://blog.zr.ci/posts/cwgi/&q;,&q;toc&q;:[{&q;id&q;:&q;新建-workers&q;,&q;title&q;:&q;新建 Workers&q;,&q;index&q;:&q;1&q;,&q;children&q;:[{&q;id&q;:&q;登陆cf之后点击-workers&q;,&q;title&q;:&q;登陆cf之后点击 Workers&q;,&q;index&q;:&q;1.1&q;},{&q;id&q;:&q;创建子域名&q;,&q;title&q;:&q;创建子域名&q;,&q;index&q;:&q;1.2&q;},{&q;id&q;:&q;点击创建-workers&q;,&q;title&q;:&q;点击创建 Workers&q;,&q;index&q;:&q;1.3&q;}]},{&q;id&q;:&q;部署代码&q;,&q;title&q;:&q;部署代码&q;,&q;index&q;:&q;2&q;,&q;children&q;:[{&q;id&q;:&q;编辑workers&q;,&q;title&q;:&q;编辑Workers&q;,&q;index&q;:&q;2.1&q;}]},{&q;id&q;:&q;绑定域名&q;,&q;title&q;:&q;绑定域名&q;,&q;index&q;:&q;3&q;,&q;children&q;:[{&q;id&q;:&q;添加路由&q;,&q;title&q;:&q;添加路由&q;,&q;index&q;:&q;3.1&q;},{&q;id&q;:&q;添加解析&q;,&q;title&q;:&q;添加解析&q;,&q;index&q;:&q;3.2&q;}]},{&q;id&q;:&q;预览&q;,&q;title&q;:&q;预览&q;,&q;index&q;:&q;4&q;}],&q;copyright&q;:{&q;author&q;:&q;箴扰&q;,&q;link&q;:&q;&l;a href=\&q;https://blog.zr.ci/posts/cwgi/\&q; title=\&q;利用Cloudflare Workers 制作Google镜像站\&q;&g;https://blog.zr.ci/posts/cwgi/&l;/a&g;&q;,&q;license&q;:&q;本博客所有文章除特别声明外，均采用(&l;a href=\&q;https://creativecommons.org/licenses/by-nc-sa/4.0/\&q; rel=\&q;nofollow\&q; target=\&q;_blank\&q;&g;CC BY-NC-SA 4.0&l;/a&g;)许可协议，转载请注明来源&l;a href=\&q;https://blog.zr.ci\&q; rel=\&q;nofollow\&q; target=\&q;_blank\&q;&g;箴扰&l;/a&g;！&q;}}}</script></head>
<body lang="zh-Hans">
<is-a class="φbm φk" ng-version="10.0.11"><is-l class="φeb φh"><div class="φel"><section class="φem"><header class="φec φf"><!----><is-c class="φed"><img draggable="false" class="φbw φw" src="https://www.gravatar.com/avatar/6a610305a94f20a4f2212eb510dc98b9?s=160" alt="" title="" width="160" height="160"></is-c><!----><a href="" class="φef φa φu">箴扰</a><p class="φee">分别便是为了重逢</p></header><div class="φeq φf"><a routerlink="/archives" class="φer φu" href="/archives"><span class="φd">14</span><span>归档</span></a><a class="φer φu" href="/categories/%E7%9E%8E%E6%8A%98%E8%85%BE"><span class="φd">2</span><span>分类</span></a><!----><a routerlink="/tags" class="φer φu" href="/tags"><span class="φd">15</span><span>标签</span></a><!----></div><!----><nav class="φen"><a class="φeo φbd φj φc φu φo" href="/">🏠　主页</a><!----><!----><!----><a class="φeo φbd φj φc φu φo" href="/links">🔗　邻居</a><!----><!----><!----><a class="φeo φbd φj φc φu φo" href="/about">📝　关于</a><!----><!----><!----><a class="φeo φbd φj φc φu φo" href="/search">🔍　搜索</a><!----><!----><!----><!----></nav><!----><div issnippet="" class="φbh"><is-palette2></is-palette2>
</div><!----><!----><!----></section><footer class="φeg φeh"><div class="φej"><a target="_blank" rel="external nofollow noopener" class="φek φbg φu icon-email" href="mailto:idkzrs@gmail.com">email</a><a target="_blank" rel="external nofollow noopener" class="φek φbg φu icon-feed" href="/atom.xml">feed</a><a target="_blank" rel="external nofollow noopener" class="φek φbg φu icon-github" href="https://github.com/idkzr">github</a><!----></div><!----><p class="φbk φz">© 2019-2020 ❤️ <a href="/">箴扰</a></p><!----><p class="φbk φz"><span class="φei">由 <a href="https://hexo.io" target="_blank" rel="external nofollow noopener">Hexo</a> 强力驱动</span><!----><span class="φei">主题 - <a href="https://github.com/ikeq/hexo-theme-inside" target="_blank" rel="external nofollow noopener">Inside</a></span><!----></p><!----><p class="φbk φz"><div><span title="总访客量"> UV : <span id="busuanzi_value_site_uv"></span></span> | <span title="总访问量"> PV : <span id="busuanzi_value_site_pv"></span></span></div></p><!----></footer></div></is-l><div class="φbo"><div class="φbn"><div class="φbs φbe"><main class="φbr φbf"><router-outlet></router-outlet><is-s class="φfx φf"><header class="φgh φgr" style="background-image:url(https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cover.jpg);background-color:#111;"><div class="φgq"><!----><p class="φgj φr"><span class="φgk φgo">2020年5月1日</span><a class="φgk φgm φu" href="/categories/%E7%9E%8E%E6%8A%98%E8%85%BE">瞎折腾</a><!----><!----><!----></p><hr class="φgs"><!----><h1 class="φgt">利用Cloudflare Workers 制作Google镜像站</h1><!----></div></header><article itemscope="" itemtype="http://schema.org/Article" class="φga" data-title="利用Cloudflare Workers 制作Google镜像站"><div itemprop="articleBody" issnippet="" iszoomable="" class="φbk φh φz"><p>今天在gayhub上面闲逛，发现了一个利用Cloudflare Workers 制作Google镜像站的方法。</p>
<a id="more"></a>
<p>Cloudflare Workers是什么各位可以自行搜索，这里不做过多介绍。</p>
<h2 id="新建-workers">新建 Workers<a title="#新建-workers" href="#新建-workers"></a></h2>
<h3 id="登陆cf之后点击-workers">登陆cf之后点击 Workers<a title="#登陆cf之后点击-workers" href="#登陆cf之后点击-workers"></a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/xjcw.jpg" alt="xjcw" class="φcx"></p>
<h3 id="创建子域名">创建子域名<a title="#创建子域名" href="#创建子域名"></a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/xjzym.jpg" alt="xjzym" class="φcx"></p>
<h3 id="点击创建-workers">点击创建 Workers<a title="#点击创建-workers" href="#点击创建-workers"></a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/cjcw.jpg" alt="cjcw" class="φcx"></p>
<h2 id="部署代码">部署代码<a title="#部署代码" href="#部署代码"></a></h2>
<h3 id="编辑workers">编辑Workers<a title="#编辑workers" href="#编辑workers"></a></h3>
<p>将以下代码粘贴至代码框</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Website you intended to retrieve for users.</span></span><br><span class="line"><span class="keyword">const</span> upstream = <span class="string">'www.google.com'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom pathname for the upstream website.</span></span><br><span class="line"><span class="keyword">const</span> upstream_path = <span class="string">'/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Website you intended to retrieve for users using mobile devices.</span></span><br><span class="line"><span class="keyword">const</span> upstream_mobile = <span class="string">'www.google.com'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Countries and regions where you wish to suspend your service.</span></span><br><span class="line"><span class="keyword">const</span> blocked_region = [<span class="string">'KP'</span>, <span class="string">'SY'</span>, <span class="string">'PK'</span>, <span class="string">'CU'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// IP addresses which you wish to block from using your service.</span></span><br><span class="line"><span class="keyword">const</span> blocked_ip_address = [<span class="string">'0.0.0.0'</span>, <span class="string">'127.0.0.1'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Whether to use HTTPS protocol for upstream address.</span></span><br><span class="line"><span class="keyword">const</span> https = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Whether to disable cache.</span></span><br><span class="line"><span class="keyword">const</span> disable_cache = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Replace texts.</span></span><br><span class="line"><span class="keyword">const</span> replace_dict = {</span><br><span class="line">    <span class="string">'$upstream'</span>: <span class="string">'$custom_domain'</span>,</span><br><span class="line">    <span class="string">'//google.com'</span>: <span class="string">''</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="params">event</span> =&gt;</span> {</span><br><span class="line">    event.respondWith(fetchAndApply(event.request));</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndApply</span>(<span class="params">request</span>) </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> region = request.headers.get(<span class="string">'cf-ipcountry'</span>).toUpperCase();</span><br><span class="line">    <span class="keyword">const</span> ip_address = request.headers.get(<span class="string">'cf-connecting-ip'</span>);</span><br><span class="line">    <span class="keyword">const</span> user_agent = request.headers.get(<span class="string">'user-agent'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> response = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="keyword">new</span> URL(request.url);</span><br><span class="line">    <span class="keyword">let</span> url_hostname = url.hostname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (https == <span class="literal">true</span>) {</span><br><span class="line">        url.protocol = <span class="string">'https:'</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        url.protocol = <span class="string">'http:'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> device_status(user_agent)) {</span><br><span class="line">        <span class="keyword">var</span> upstream_domain = upstream;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">var</span> upstream_domain = upstream_mobile;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    url.host = upstream_domain;</span><br><span class="line">    <span class="keyword">if</span> (url.pathname == <span class="string">'/'</span>) {</span><br><span class="line">        url.pathname = upstream_path;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        url.pathname = upstream_path + url.pathname;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (blocked_region.includes(region)) {</span><br><span class="line">        response = <span class="keyword">new</span> Response(<span class="string">'Access denied: WorkersProxy is not available in your region yet.'</span>, {</span><br><span class="line">            status: <span class="number">403</span></span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (blocked_ip_address.includes(ip_address)) {</span><br><span class="line">        response = <span class="keyword">new</span> Response(<span class="string">'Access denied: Your IP address is blocked by WorkersProxy.'</span>, {</span><br><span class="line">            status: <span class="number">403</span></span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">let</span> method = request.method;</span><br><span class="line">        <span class="keyword">let</span> request_headers = request.headers;</span><br><span class="line">        <span class="keyword">let</span> new_request_headers = <span class="keyword">new</span> Headers(request_headers);</span><br><span class="line"></span><br><span class="line">        new_request_headers.set(<span class="string">'Host'</span>, url.hostname);</span><br><span class="line">        new_request_headers.set(<span class="string">'Referer'</span>, url.hostname);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> original_response = <span class="keyword">await</span> fetch(url.href, {</span><br><span class="line">            method: method,</span><br><span class="line">            headers: new_request_headers</span><br><span class="line">        })</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> original_response_clone = original_response.clone();</span><br><span class="line">        <span class="keyword">let</span> original_text = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> response_headers = original_response.headers;</span><br><span class="line">        <span class="keyword">let</span> new_response_headers = <span class="keyword">new</span> Headers(response_headers);</span><br><span class="line">        <span class="keyword">let</span> status = original_response.status;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (disable_cache) {</span><br><span class="line">            new_response_headers.set(<span class="string">'Cache-Control'</span>, <span class="string">'no-store'</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        new_response_headers.set(<span class="string">'access-control-allow-origin'</span>, <span class="string">'*'</span>);</span><br><span class="line">        new_response_headers.set(<span class="string">'access-control-allow-credentials'</span>, <span class="literal">true</span>);</span><br><span class="line">        new_response_headers.delete(<span class="string">'content-security-policy'</span>);</span><br><span class="line">        new_response_headers.delete(<span class="string">'content-security-policy-report-only'</span>);</span><br><span class="line">        new_response_headers.delete(<span class="string">'clear-site-data'</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(new_response_headers.get(<span class="string">"x-pjax-url"</span>)) {</span><br><span class="line">            new_response_headers.set(<span class="string">"x-pjax-url"</span>, response_headers.get(<span class="string">"x-pjax-url"</span>).replace(<span class="string">"//"</span> + upstream_domain, <span class="string">"//"</span> + url_hostname));</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> content_type = new_response_headers.get(<span class="string">'content-type'</span>);</span><br><span class="line">        <span class="keyword">if</span> (content_type.includes(<span class="string">'text/html'</span>) &amp;&amp; content_type.includes(<span class="string">'UTF-8'</span>)) {</span><br><span class="line">            original_text = <span class="keyword">await</span> replace_response_text(original_response_clone, upstream_domain, url_hostname);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            original_text = original_response_clone.body</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        response = <span class="keyword">new</span> Response(original_text, {</span><br><span class="line">            status,</span><br><span class="line">            headers: new_response_headers</span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">replace_response_text</span>(<span class="params">response, upstream_domain, host_name</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> text = <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> replace_dict) {</span><br><span class="line">        j = replace_dict[i]</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="string">'$upstream'</span>) {</span><br><span class="line">            i = upstream_domain</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="string">'$custom_domain'</span>) {</span><br><span class="line">            i = host_name</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (j == <span class="string">'$upstream'</span>) {</span><br><span class="line">            j = upstream_domain</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="string">'$custom_domain'</span>) {</span><br><span class="line">            j = host_name</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(i, <span class="string">'g'</span>)</span><br><span class="line">        text = text.replace(re, j);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> text;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">device_status</span>(<span class="params">user_agent_info</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> agents = [<span class="string">"Android"</span>, <span class="string">"iPhone"</span>, <span class="string">"SymbianOS"</span>, <span class="string">"Windows Phone"</span>, <span class="string">"iPad"</span>, <span class="string">"iPod"</span>];</span><br><span class="line">    <span class="keyword">var</span> flag = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> v = <span class="number">0</span>; v &lt; agents.length; v++) {</span><br><span class="line">        <span class="keyword">if</span> (user_agent_info.indexOf(agents[v]) &gt; <span class="number">0</span>) {</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>点击左上角修改项目名（可选）<br>
点击右下角保存并部署</p>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/xgdm.jpg" alt="xgdm" class="φcx"></p>
<p>确认部署</p>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/bs.jpg" alt="bs" class="φcx"></p>
<p>点击预览查看</p>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/yl.jpg" alt="yl" class="φcx"></p>
<h2 id="绑定域名">绑定域名<a title="#绑定域名" href="#绑定域名"></a></h2>
<h3 id="添加路由">添加路由<a title="#添加路由" href="#添加路由"></a></h3>
<p>回到域名管理，选择你的域名</p>
<p>点击Workers，点击添加路由</p>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/ly.jpg" alt="ly" class="φcx"></p>
<p>路由填写你需要解析的域名，Workers选择刚刚新建的Workers项目名<br>
我这里以<code>gogoogle.ml</code>举例，注意在域名后面填写<code>/*</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/qr.jpg" alt="qr" class="φcx"></p>
<h3 id="添加解析">添加解析<a title="#添加解析" href="#添加解析"></a></h3>
<p>这个是可以随便填写的，无论你写的什么，cf都会绑定到Workers上面</p>
<p><img src="https://cdn.jsdelivr.net/gh/idkzr/static@master/imgs/cwgi/jx.jpg" alt="jx" class="φcx"></p>
<h2 id="预览">预览<a title="#预览" href="#预览"></a></h2>
<p>!!!</p>
<center>
[btnyellow href="http://gogoogle.ml/" target="blank"]点击预览[/btnyellow]</center>
!!!
</div><is-f class="φcc φv φs"><!----><ul class="φcg"><li class="φce"><strong class="φcf">本文作者<span>:</span></strong><p class="φcd">箴扰</p></li><li class="φce"><strong class="φcf">本文链接<span>:</span></strong><p class="φcd"><a href="https://blog.zr.ci/posts/cwgi/" title="利用Cloudflare Workers 制作Google镜像站">https://blog.zr.ci/posts/cwgi/</a></p></li><li class="φce"><strong class="φcf">版权声明<span>:</span></strong><p class="φcd">本博客所有文章除特别声明外，均采用(<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="nofollow" target="_blank">CC BY-NC-SA 4.0</a>)许可协议，转载请注明来源<a href="https://blog.zr.ci" rel="nofollow" target="_blank">箴扰</a>！</p></li><!----></ul><!----></is-f><!----><!----><!----></article><footer class="φgb φh"><div class="φgg"><is-m class="φet"><a class="φeu φs φq" href="/tags/Workers">Workers</a></is-m><is-m class="φet"><a class="φeu φs φq" href="/tags/web">web</a></is-m><!----></div><!----><div class="φgc"><a class="φgd φgf φu" href="/posts/usbjk">盘点那些数量繁多的USB接口</a><!----><a class="φgd φge φu" href="/posts/freecdn">盘点一下那些我用过的免费CDN</a><!----></div><!----></footer><is-e class="φbz φh"><div issnippet="" class="φbh"><div id="vcomment"></div>

</div><!----><!----><!----><!----></is-e><!----><!----><!----></is-s><!----></main><!----></div></div></div><is-g class="φch"><div class="φcq"><span class="φbg icon-up"></span><span class="φbg icon-down"></span><!----><span class="φbg icon-toc"></span><!----><span class="φbg icon-search"></span><!----></div><div class="φcj φck"><svg class="φcp"><defs><filter id="dp"><feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur></filter></defs><circle filter="url(#dp)" fill="rgba(0,0,0,.3)" cx="50%" cy="52%" r="44%"></circle><circle cx="50%" cy="50%" r="44%" class="φcl φbb"></circle><circle cx="50%" cy="50%" r="48%" class="φco φba" stroke-dasharray="0% 314.15926%"></circle><!----><g class="φcm"><circle r=".2rem" cx="0" cy="-.8rem"></circle><circle r=".2rem"></circle><circle r=".2rem" cx="0" cy=".8rem"></circle></g><!----></svg></div></is-g><is-n class="φev φf"><div class="φex φey φn"><a class="φfa φu"><!----><span class="φfc">新建 Workers</span></a><div class="φex"><a class="φfa φu"><!----><span class="φfc">登陆cf之后点击 Workers</span></a><!----></div><div class="φex"><a class="φfa φu"><!----><span class="φfc">创建子域名</span></a><!----></div><div class="φex"><a class="φfa φu"><!----><span class="φfc">点击创建 Workers</span></a><!----></div><!----><!----><!----></div><div class="φex φey φn"><a class="φfa φu"><!----><span class="φfc">部署代码</span></a><div class="φex"><a class="φfa φu"><!----><span class="φfc">编辑Workers</span></a><!----></div><!----><!----><!----></div><div class="φex φey φn"><a class="φfa φu"><!----><span class="φfc">绑定域名</span></a><div class="φex"><a class="φfa φu"><!----><span class="φfc">添加路由</span></a><!----></div><div class="φex"><a class="φfa φu"><!----><span class="φfc">添加解析</span></a><!----></div><!----><!----><!----></div><div class="φex φey φn"><a class="φfa φu"><!----><span class="φfc">预览</span></a><!----></div><!----></is-n><!----><!----></is-a>
<script src="//cdn.jsdelivr.net/gh/idkzr/static@master/inside/bsz.js"></script><script src="//cdn.jsdelivr.net/gh/idkzr/static@master/inside/themes.js"></script><script src="//cdn.jsdelivr.net/gh/idkzr/static@master/inside/theme.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script src="/runtime.b15aa7186c559b492b7d.js"></script><script src="/polyfills.824ff89b5f3ca4543a31.js"></script><script src="/main.03652fc423a687c817e8.js"></script>

</body></html>